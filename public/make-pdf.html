<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creating Recipe PDF</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.4/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.4/vfs_fonts.js"></script>
    
    <script>
        //  временнная заглушка полученного от API рецепта:
        const recipeData = {
            id: "02fe",
            title: "Омлет",
            ingredients: [
                {
                    ingredient: "Яйца",
                    amount: "3шт",
                },
                {
                    ingredient: "Молоко",
                    amount: "300г",
                },
            ],
            stepsData: [
                {
                    title: "шаг 1",
                    description: "Рыбное филе порезать на мелкие кусочки",
                },
                {
                    title: "шаг 2",
                    description:
                    "Смешать соевый соус и кетчуп, посыпать измельченным чесноком. Соус поставить в холодильник  ",
                },
                {
                    title: "шаг 3",
                    description:
                    "Рыбное филе обвалять в муке и соли. Обжарить на сковородке",
                },
            ],
            time: 48,
            author: "Cooker",
            typeOfMeal: "обед",
            portionsAmount: 3,
            cost: 22,
            dateCreation: "31.11.21",
        };
        
        
        //  сначала - запрос к серверу по айдишнику fetch() -> recipeData
        function getAPIdata(recipeId){
            //  fetch()
            //  then    ->  buildPDF(recipeData)
        }

        function buildPDF(){
            const content = arraizeData(recipeData);
            var docDefinition = {
                content,
                styles: css
            };
            pdfMake.createPdf(docDefinition).download("CookBook-"+recipeData.title);
        }
        function arraizeData(data){
            const time = data.time ? data.time : null;
            const author = data.author ? data.author : null;
            const typeOfMeal = data.typeOfMeal ? data.typeOfMeal : null;
            const portionsAmount = data.portionsAmount ? data.portionsAmount : null;
            const cost = data.cost ? data.cost : null;
            const dateCreation = data.dateCreation ? data.dateCreation : null;

            const content = [
                { text: 'CookBook: '+data.id+" - "+data.author, style:['cookbookLogo'] },
                {
                    text: data.title,
                    style:['title']
                },
                ' ',
                { text: 'Ингридиенты:', style:'propsTitle' },
                data.ingredients.map((ing)=>{
                    return ing.ingredient + " - "+ing.amount;
                }),
                ' ',
            ];
            if(time) content.push(
                    { text: 'Время приготовления:', style:'propsTitle' }, 
                    { text: time+" минут", style:'props' }, " ");
            if(portionsAmount) content.push(
                    { text: 'Количество персон:', style:'propsTitle' }, 
                    { text: portionsAmount+" персон", style:'props' }, " ");
            if(time) content.push(
                    { text: 'Разновидность блюда:', style:'propsTitle' }, 
                    { text: typeOfMeal, style:'props' }, " ");

            content.push({ text: 'Процесс приготовления', style:'subTitle' });
            content.push(
                ...data.stepsData.map((step,idx)=>{
                    return [{ text:"шаг "+(idx+1), style:'step' },
                    { text:" "+step.description, style:'stepText' }]
                })
            );

            return content;
        }

        const css = {
            cookbookLogo:{
                margin: [2,2,0,0],
                color: '#ccc',
                fontSize: 14,
            },
            title:{
                alignment: 'center',
                fontSize: 20,
            },
            subTitle:{
                fontSize: 18,
                alignment: 'center',
            },
            props:{
                fontSize: 12
            },
            propsTitle:{
                fontSize: 14
            },
            ingrLeft:{
                alignment: 'right',
                margin:[0,0,10,0]
            },

            step:{
                fontSize: 8
            },
            stepText:{

            }
        };
            
            
    </script>
</head>
<body>
    <h1>PDF-make</h1>
    <p>Можно будет открывать эту страницу новым окном с GET-параметром 'ID рецепта', который зафетчит и по полученным данным построит PDF</p>
    <i>этой нопки не будет, функция запустится после открытия стрницы</i>
    <button onclick="buildPDF()">Build PDF </button>
</body>
</html>